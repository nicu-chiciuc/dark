<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dark Editor - GPT-4 API</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
  <div id="app" class="h-full flex">
    <div class="w-1/2 p-4 bg-gray-100">
      <form @submit.prevent="handleSubmit" class="flex flex-col h-full">
        <input type="text" name="dark-editor" v-model="darkEditor" class="mb-4 p-2 border border-gray-300 rounded" />
        <textarea id="dark-prompt" name="dark-prompt" v-model="darkPrompt"
          class="mb-4 h-20 p-2 border border-gray-300 rounded resize-none"></textarea>

        <button @click="getPrompt" class="mb-4 px-4 py-2 bg-green-500 text-white rounded">Get prompt</button>
        <button @click="savePrompt" class="mb-4 px-4 py-2 bg-green-500 text-white rounded">Save the new prompt</button>

        <textarea name="prompt" v-model="prompt" placeholder="Insert prompt here"
          class="mb-4 flex-grow p-2 border border-gray-300 rounded resize-none"></textarea>
        <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded">Submit</button>
      </form>
    </div>
    <div class="w-1/2 p-4 bg-gray-200">
      <textarea id="output" v-model="output" disabled
        class="mb-4 w-full h-80 p-2 bg-gray-300 text-gray-600 border border-gray-300 rounded resize-none"></textarea>
      <form @submit.prevent="handleVarFormSubmit" class="mb-4">
        <div v-for="(variable, index) in variables" :key="index">
          <label>{{ variable }}</label>
          <input name="variable" v-model="formElements[index]" class="mb-2 p-2 border border-gray-300 rounded" />
        </div>
        <button v-if="variables.length > 0" type="submit"
          class="px-4 py-2 bg-green-500 text-white rounded">Submit</button>
      </form>
      <button @click="copy" class="px-4 py-2 bg-green-500 text-white rounded">Copy code</button>
      <button @click="fillVariables" class="px-4 py-2 bg-green-500 text-white rounded">Fill variables</button>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive } = Vue;

    const app = createApp({
      setup() {
        const darkEditor = ref('dark-editor');
        const darkPrompt = ref('');
        const prompt = ref('');
        const output = ref('');
        const variables = ref([]);
        const formElements = reactive([]);

        const handleSubmit = async () => {
          const response = await fetch("/api/gpt4", {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: darkPrompt.value + prompt.value,
          });

          if (response.ok) {
            const data = await response.json();
            output.value = data.choices[0].text;
          } else {
            const text = await response.text();
            output.value =
              "Error calling the GPT-4 API: " + response.status + " " + response.statusText + " " + text;
          }
        };

        const getPrompt = async () => {
          const response = await fetch('/get-prompt');
          if (response.ok) {
            darkPrompt.value = await response.text();
          } else {
            console.error('Error fetching prompt:', response.statusText);
          }
        };

        const savePrompt = async () => {
          const response = await fetch("/save-prompt", {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: darkPrompt.value,
          });
        };

        const copy = () => {
          navigator.clipboard.writeText(output.value).then(() => {
            console.log("Text copied to clipboard");
          }).catch((error) => {
            console.error('Error copying text to clipboard:', error);
          });
        };

        const fillVariables = () => {
          const foundVariables = output.value.match(/variables:\n([\s\S]*)/)[1].trim().split('\n').filter(Boolean);
          variables.value = foundVariables;
        };

        const handleVarFormSubmit = () => {
          for (let i = 0; i < variables.value.length; i++) {
            console.log(variables.value[i] + ': ' + formElements[i]);
          }
        };

        return {
          darkEditor,
          darkPrompt,
          prompt,
          output,
          variables,
          formElements,
          handleSubmit,
          getPrompt,
          savePrompt,
          copy,
          fillVariables,
          handleVarFormSubmit
        };
      },
    });

    app.mount('#app');
  </script>
</body>

</html>